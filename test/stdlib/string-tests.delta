// RUN: check_exit_status 0 %delta run -Werror %s test-support.delta

func main() {
    assert("abc" == "abc", "equals");
    assert(!("abc" == "not"), "not equals");
    assert("abc" < "bcd", "less");

    testStringIterator();
    testFind();
    testSubstr();
    testSplit();
    testOtherSplit();
}

func testStringIterator() {
    var iterator = "xy".iterator();

    assert(iterator.hasValue(), "testStringIterator: hasValue() - 1");
    assert(iterator.value() == 'x', "testStringIterator: value() - 1");

    iterator.increment();
    assert(iterator.hasValue(), "testStringIterator: hasValue() - 2");
    assert(iterator.value() == 'y', "testStringIterator: value() - 2");

    iterator.increment();
    assert(!iterator.hasValue(), "testStringIterator: hasValue() - 3");
}

func testFind() {
    var s = String("word");

    // Start from beginning
    assert(s.find('w') == 0, "The index of w is 0");
    assert(s.find('o') == 1, "The index of o is 1");
    assert(s.find('r') == 2, "The index of r is 2");
    assert(s.find('d') == 3, "The index of d is 3");

    // Start from index

    assert(s.find('w', 1) == -1, "Not found if starting from later");
    assert(s.find('d', 2) == 3, "Still found if starting from 2");
}

func testSubstr() {
    var s = String("word");

    assert(s.substr(0..1) == "w", "Substring works correctly");
    assert(s.substr(0..2) == "wo", "Substring works correctly");
    assert(s.substr(0..3) == "wor", "Substring works correctly");
    assert(s.substr(0..4) == "word", "Substring works correctly");
    assert(s.substr(1..4) == "ord", "Substring works correctly");
    assert(s.substr(2..4) == "rd", "Substring works correctly");
    assert(s.substr(1..3) == "or", "Substring works correctly");
    assert(s.substr(2..3) == "r", "Substring works correctly");


    var s2 = String("this is the best sentence");

    assert(s2.substr(0..4) == "this" ,"Works with longer sentences");
    assert(s2.substr(5..7) == "is", "Works with longer sentences");
    assert(s2.substr(8..11) == "the", "Works with longer sentences");
    assert(s2.substr(12..16) == "best", "Works with longer sentences");
    assert(s2.substr(17..25) == "sentence", "Works with longer sentences");

    var s3 = String("best");

    assert(s3.substr(0..0) == "", "Works on empty intervals");
}

func testSplit() {
    var s = String("this is the best sentence");

    var words = s.split();

    assert(*words[0] == "this", "The 0 words match");
    assert(*words[1] == "is", "The 1 words match");
    assert(*words[2] == "the", "The 2 words match");
    assert(*words[3] == "best", "The 3 words match");
    assert(*words[4] == "sentence", "The 4 words match");

    assert(words.size() == 5, "split into 5 parts");
}

func testOtherSplit() {
    var s = String("this,sentence,is,comma,separated");

    var words = s.split(',');

    assert(*words[0] == "this", "The 0 words match");
    assert(*words[1] == "sentence", "The 1 words match");
    assert(*words[2] == "is", "The 2 words match");
    assert(*words[3] == "comma", "The 3 words match");
    assert(*words[4] == "separated", "The 4 words match");

    assert(words.size() == 5, "split into 5 parts");


    var s2 = String(",,1,,2");

    words = s2.split(',');

    assert(*words[0] == "", "empty 1 works");
    assert(*words[1] == "", "empty 2 works");
    assert(*words[2] == "1", "empty 3 works");
    assert(*words[3] == "", "empty 4 works");
    assert(*words[4] == "2", "empty 5 works");

    assert(words.size() == 5, "Split array is the right size");


    var s3 = String(",,,b,a,,,");

    words = s3.split(',');

    assert(*words[0] == "", "empty 1 works");
    assert(*words[1] == "", "empty 2 works");
    assert(*words[2] == "", "empty 3 works");
    assert(*words[3] == "b", "empty 4 works");
    assert(*words[4] == "a", "empty 5 works");
    assert(*words[5] == "", "empty 6 works");
    assert(*words[6] == "", "empty 7 works");
    assert(*words[7] == "", "empty 8 works");

    assert(words.size() == 8, "Split array the correct size");
}
